<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.liketry.interaction.benison.dao.PromotionDetailMapper">
    <resultMap id="BaseResultMap" type="com.liketry.interaction.benison.model.PromotionDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        <id column="detail_id" property="detailId" jdbcType="VARCHAR"/>
        <result column="promotion_id" property="promotionId" jdbcType="VARCHAR"/>
        <result column="commodity_id" property="commodityId" jdbcType="VARCHAR"/>
        <result column="commodity_num" property="commodityNum" jdbcType="INTEGER"/>
        <result column="discount_ratio" property="discountRatio" jdbcType="FLOAT"/>
        <result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
        <result column="created_by" property="createdBy" jdbcType="VARCHAR"/>
        <result column="modified_time" property="modifiedTime" jdbcType="TIMESTAMP"/>
        <result column="modified_by" property="modifiedBy" jdbcType="VARCHAR"/>
        <result column="version" property="version" jdbcType="INTEGER"/>
        <result column="delflag" property="delflag" jdbcType="CHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        detail_id, promotion_id, commodity_id, commodity_num, discount_ratio, created_time, created_by,
        modified_time, modified_by, version, delflag, commodity_num
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        select
        <include refid="Base_Column_List"/>
        from bu_promotion_detail
        where detail_id = #{detailId,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        delete from bu_promotion_detail
        where detail_id = #{detailId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.liketry.interaction.benison.model.PromotionDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        insert into bu_promotion_detail (detail_id, promotion_id, commodity_id, commodity_num,
        discount_ratio, created_time, created_by,
        modified_time, modified_by, version,
        delflag)
        values (#{detailId,jdbcType=VARCHAR}, #{promotionId,jdbcType=VARCHAR}, #{commodityId,jdbcType=VARCHAR},
        #{commodityNum,jdbcType=VARCHAR},
        #{discountRatio,jdbcType=INTEGER}, #{createdTime,jdbcType=TIMESTAMP}, #{createdBy,jdbcType=VARCHAR},
        #{modifiedTime,jdbcType=TIMESTAMP}, #{modifiedBy,jdbcType=VARCHAR}, #{version,jdbcType=INTEGER},
        #{delflag,jdbcType=CHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.liketry.interaction.benison.model.PromotionDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        insert into bu_promotion_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="detailId != null">
                detail_id,
            </if>
            <if test="promotionId != null">
                promotion_id,
            </if>
            <if test="commodityId != null">
                commodity_id,
            </if>
            <if test="commodityNum != null">
                commodity_num,
            </if>
            <if test="discountRatio != null">
                discount_ratio,
            </if>
            <if test="createdTime != null">
                created_time,
            </if>
            <if test="createdBy != null">
                created_by,
            </if>
            <if test="modifiedTime != null">
                modified_time,
            </if>
            <if test="modifiedBy != null">
                modified_by,
            </if>
            <if test="version != null">
                version,
            </if>
            <if test="delflag != null">
                delflag
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="detailId != null">
                #{detailId,jdbcType=VARCHAR},
            </if>
            <if test="promotionId != null">
                #{promotionId,jdbcType=VARCHAR},
            </if>
            <if test="commodityId != null">
                #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null">
                #{commodityNum,jdbcType=VARCHAR},
            </if>
            <if test="discountRatio != null">
                #{discountRatio,jdbcType=INTEGER},
            </if>
            <if test="createdTime != null">
                #{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createdBy != null">
                #{createdBy,jdbcType=VARCHAR},
            </if>
            <if test="modifiedTime != null">
                #{modifiedTime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifiedBy != null">
                #{modifiedBy,jdbcType=VARCHAR},
            </if>
            <if test="version != null">
                #{version,jdbcType=INTEGER},
            </if>
            <if test="delflag != null">
                #{delflag,jdbcType=CHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.liketry.interaction.benison.model.PromotionDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        update bu_promotion_detail
        <set>
            <if test="promotionId != null">
                promotion_id = #{promotionId,jdbcType=VARCHAR},
            </if>
            <if test="commodityId != null">
                commodity_id = #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="commodityNum != null">
                commodity_num = #{commodityNum,jdbcType=VARCHAR},
            </if>
            <if test="discountRatio != null">
                discount_ratio = #{discountRatio,jdbcType=INTEGER},
            </if>
            <if test="createdTime != null">
                created_time = #{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createdBy != null">
                created_by = #{createdBy,jdbcType=VARCHAR},
            </if>
            <if test="modifiedTime != null">
                modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifiedBy != null">
                modified_by = #{modifiedBy,jdbcType=VARCHAR},
            </if>
            <if test="version != null">
                version = #{version,jdbcType=INTEGER},
            </if>
            <if test="delflag != null">
                delflag = #{delflag,jdbcType=CHAR},
            </if>
        </set>
        where detail_id = #{detailId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.liketry.interaction.benison.model.PromotionDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 08 10:43:43 CST 2017.
        -->
        update bu_promotion_detail
        set promotion_id = #{promotionId,jdbcType=VARCHAR},
        commodity_id = #{commodityId,jdbcType=VARCHAR},
        commodity_num = #{commodityNum,jdbcType=VARCHAR},
        discount_ratio = #{discountRatio,jdbcType=INTEGER},
        created_time = #{createdTime,jdbcType=TIMESTAMP},
        created_by = #{createdBy,jdbcType=VARCHAR},
        modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
        modified_by = #{modifiedBy,jdbcType=VARCHAR},
        version = #{version,jdbcType=INTEGER},
        delflag = #{delflag,jdbcType=CHAR}
        where detail_id = #{detailId,jdbcType=VARCHAR}
    </update>

    <sql id="Promotion_Column_List">
        detail_id,promotion_id,discount_ratio,
        bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, bu_commodity.screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,commodity_img,
        sales,stock,stock_date,stock_status,schedule_status,screen_name,screen_location
   </sql>
    <resultMap id="PromotionResultMap" type="com.liketry.interaction.benison.vo.api.PromotionCommodityVo">
        <id column="commodity_id" jdbcType="VARCHAR" property="commodityId"/>
        <result column="commodity_code" jdbcType="VARCHAR" property="commodityCode"/>
        <result column="commodity_name" jdbcType="VARCHAR" property="commodityName"/>
        <result column="commodity_description" jdbcType="VARCHAR" property="commodityDescription"/>
        <result column="commodity_type" jdbcType="CHAR" property="commodityType"/>
        <result column="commodity_status" jdbcType="CHAR" property="commodityStatus"/>
        <result column="commodity_price" jdbcType="DECIMAL" property="commodityPrice"/>
        <result column="commodity_img" jdbcType="VARCHAR" property="commodityImg"/>
        <result column="screen_id" jdbcType="VARCHAR" property="screenId"/>
        <result column="start_date" jdbcType="VARCHAR" property="startDate"/>
        <result column="end_date" jdbcType="VARCHAR" property="endDate"/>
        <result column="time_frame" jdbcType="CHAR" property="timeFrame"/>
        <result column="start_time" jdbcType="VARCHAR" property="startTime"/>
        <result column="end_time" jdbcType="VARCHAR" property="endTime"/>
        <result column="shelf_time" jdbcType="VARCHAR" property="shelfTime"/>
        <result column="plan_number" jdbcType="INTEGER" property="planNumber"/>
        <result column="single_time" jdbcType="INTEGER" property="singleTime"/>
        <result column="play_times" jdbcType="INTEGER" property="playTimes"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="created_by" jdbcType="VARCHAR" property="createdBy"/>
        <result column="stock_status" jdbcType="VARCHAR" property="stockStatus"/>
        <result column="schedule_status" jdbcType="VARCHAR" property="scheduleStatus"/>
        <result column="sales" jdbcType="VARCHAR" property="sales"/>
        <result column="stock" jdbcType="VARCHAR" property="stock"/>
        <result column="commodity_num" jdbcType="INTEGER" property="commodityNum"/>

        <result column="detail_id" jdbcType="VARCHAR" property="detailId"/>
        <result column="promotion_id" jdbcType="VARCHAR" property="promotionId"/>
        <result column="discount_ratio" jdbcType="VARCHAR" property="discountRatio"/>

        <result column="screen_name" jdbcType="VARCHAR" property="screenName"/>
        <result column="screen_location" jdbcType="VARCHAR" property="screenLocation"/>
    </resultMap>
    <select id="findPromotionDetailList" resultMap="PromotionResultMap">
        SELECT  detail_id,promotion_id,discount_ratio, bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, bu_commodity.screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,commodity_img,
 screen_name, screen_location, commodity_num
 FROM  bu_promotion_detail,bu_commodity, bu_screen where bu_promotion_detail.commodity_id = bu_commodity.commodity_id  and bu_commodity.screen_id = bu_screen.screen_id
 AND bu_promotion_detail.promotion_id = #{promotionId}
 AND commodity_status = 1
    </select>
    <!--<select id="findPromotionDetailList" resultMap="PromotionResultMap">-->
    <!--(SELECT-->
    <!--<include refid="Promotion_Column_List"/>-->
    <!--,'1' as display, true as promotionLimit,-->
    <!--(SELECT count(*) FROM bu_order left join bu_order_detail on bu_order.order_id = bu_order_detail.order_id where bu_order.promotion_id = #{promotionId} and bu_order.order_status in (1, 2, 3) and-->
    <!--str_to_date(bu_order_detail.play_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}) AS promotion_size-->
    <!--FROM interaction.bu_promotion_detail,bu_commodity,bu_stock,bu_screen-->
    <!--where bu_promotion_detail.commodity_id = bu_commodity.commodity_id and bu_commodity.commodity_id = bu_stock.commodity_id and bu_commodity.screen_id = bu_screen.screen_id-->
    <!--and promotion_id = #{promotionId}-->
    <!--and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') >= #{reserveDate,jdbcType=DATE}-->
    <!--and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}-->
    <!--and (str_to_date(stock_date,'%Y-%m-%d') &gt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')))-->
    <!--<if test="limitSize != null and limitSize != 0">-->
    <!--and promotion_size &lt; #{limitSize,jdbcType=INTEGER}-->
    <!--</if>-->
    <!--ORDER BY shelf_time ASC)-->
    <!--union all-->
    <!--(SELECT-->
    <!--<include refid="Promotion_Column_List"/>-->
    <!--,'0' as display, false as promotionLimit,-->
    <!--(SELECT count(*) FROM bu_order left join bu_order_detail on bu_order.order_id = bu_order_detail.order_id where bu_order.promotion_id = #{promotionId} and bu_order.order_status in (1, 2, 3) and-->
    <!--str_to_date(bu_order_detail.play_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}) AS promotion_size-->
    <!--FROM interaction.bu_promotion_detail,bu_commodity,bu_stock,bu_screen-->
    <!--where bu_promotion_detail.commodity_id = bu_commodity.commodity_id and bu_commodity.commodity_id = bu_stock.commodity_id and bu_commodity.screen_id = bu_screen.screen_id-->
    <!--and promotion_id = #{promotionId}-->
    <!--and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') >= #{reserveDate,jdbcType=DATE}-->
    <!--and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}-->
    <!--and (-->
    <!--(str_to_date(stock_date,'%Y-%m-%d') &lt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &lt;= DATE_FORMAT(curtime(),'%H:%i')))-->
    <!--<if test="limitSize != null and limitSize != 0">-->
    <!--or promotion_size >= #{limitSize, jdbcType=INTEGER}-->
    <!--</if>-->
    <!--)-->
    <!--ORDER BY shelf_time ASC)-->
    <!--</select>-->

    <!--<select id="findPromotionDetailList" resultMap="PromotionResultMap">-->
    <!--(SELECT <include refid="Promotion_Column_List" /> ,'1' as display-->
    <!--FROM interaction.bu_promotion_detail,bu_commodity,bu_stock,bu_screen-->
    <!--where bu_promotion_detail.commodity_id = bu_commodity.commodity_id and bu_commodity.commodity_id = bu_stock.commodity_id and bu_commodity.screen_id = bu_screen.screen_id-->
    <!--and promotion_id = #{promotionId}-->
    <!--and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') >= #{reserveDate,jdbcType=DATE}-->
    <!--and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}-->
    <!--and (str_to_date(stock_date,'%Y-%m-%d') &gt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')))-->
    <!--ORDER BY shelf_time ASC)-->
    <!--union all-->
    <!--(SELECT <include refid="Promotion_Column_List" /> ,'0' as display-->
    <!--FROM interaction.bu_promotion_detail,bu_commodity,bu_stock,bu_screen-->
    <!--where bu_promotion_detail.commodity_id = bu_commodity.commodity_id and bu_commodity.commodity_id = bu_stock.commodity_id and bu_commodity.screen_id = bu_screen.screen_id-->
    <!--and promotion_id = #{promotionId}-->
    <!--and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') >= #{reserveDate,jdbcType=DATE}-->
    <!--and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}-->
    <!--and (str_to_date(stock_date,'%Y-%m-%d') &lt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &lt;= DATE_FORMAT(curtime(),'%H:%i')))-->
    <!--ORDER BY shelf_time ASC)-->
    <!--</select>-->

    <select id="findPartakeNumber" resultType="Integer">
    select count(*) from bu_promotion,bu_promotion_detail,bu_order_detail
    where bu_promotion.promotion_id = bu_promotion_detail.promotion_id
    and bu_promotion_detail.commodity_id = bu_order_detail.commodity_id
    and bu_promotion.promotion_id = #{promotionId}
  </select>

    <select id="getPromotionDetailList" parameterType="java.util.Map" resultMap="BaseResultMap">
        select * from bu_promotion_detail where 1 = 1
        <if test="promotionId != null">
            and promotion_id = #{promotionId,jdbcType=VARCHAR}
        </if>
        <if test="commodityId != null">
            and commodity_id = #{commodityId,jdbcType=VARCHAR}
        </if>
    </select>

    <select id="findDetails" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/> FROM interaction.bu_promotion_detail
        where promotion_id = #{promotionId,jdbcType=VARCHAR}
        and commodity_id = #{commodityId,jdbcType=VARCHAR}
    </select>

</mapper>