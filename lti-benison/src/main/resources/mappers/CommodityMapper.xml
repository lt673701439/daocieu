<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.liketry.interaction.benison.dao.CommodityMapper">
    <resultMap id="BaseResultMap" type="com.liketry.interaction.benison.model.Commodity">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        <id column="commodity_id" jdbcType="VARCHAR" property="commodityId"/>
        <result column="commodity_code" jdbcType="VARCHAR" property="commodityCode"/>
        <result column="commodity_name" jdbcType="VARCHAR" property="commodityName"/>
        <result column="commodity_description" jdbcType="VARCHAR" property="commodityDescription"/>
        <result column="commodity_type" jdbcType="CHAR" property="commodityType"/>
        <result column="commodity_status" jdbcType="CHAR" property="commodityStatus"/>
        <result column="commodity_price" jdbcType="DECIMAL" property="commodityPrice"/>
        <result column="commodity_img" jdbcType="VARCHAR" property="commodityImg"/>
        <result column="screen_id" jdbcType="VARCHAR" property="screenId"/>
        <result column="start_date" jdbcType="VARCHAR" property="startDate"/>
        <result column="end_date" jdbcType="VARCHAR" property="endDate"/>
        <result column="time_frame" jdbcType="CHAR" property="timeFrame"/>
        <result column="start_time" jdbcType="VARCHAR" property="startTime"/>
        <result column="end_time" jdbcType="VARCHAR" property="endTime"/>
        <result column="shelf_time" jdbcType="VARCHAR" property="shelfTime"/>
        <result column="plan_number" jdbcType="INTEGER" property="planNumber"/>
        <result column="single_time" jdbcType="INTEGER" property="singleTime"/>
        <result column="play_times" jdbcType="INTEGER" property="playTimes"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="created_by" jdbcType="VARCHAR" property="createdBy"/>
        <result column="modified_time" jdbcType="TIMESTAMP" property="modifiedTime"/>
        <result column="modified_by" jdbcType="VARCHAR" property="modifiedBy"/>
        <result column="version" jdbcType="INTEGER" property="version"/>
        <result column="delflag" jdbcType="CHAR" property="delflag"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        commodity_id, commodity_code, commodity_name, commodity_description, commodity_type,
        commodity_status, commodity_price, commodity_img, screen_id, start_date, end_date,
        time_frame, start_time, end_time, shelf_time, plan_number, single_time, play_times,
        created_time, created_by, modified_time, modified_by, version, delflag
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        select
        <include refid="Base_Column_List"/>
        from bu_commodity
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        delete from bu_commodity
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.liketry.interaction.benison.model.Commodity">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        insert into bu_commodity (commodity_id, commodity_code, commodity_name,
        commodity_description, commodity_type, commodity_status,
        commodity_price, commodity_img, screen_id,
        start_date, end_date, time_frame,
        start_time, end_time, shelf_time,
        plan_number, single_time, play_times,
        created_time, created_by, modified_time,
        modified_by, version, delflag
        )
        values (#{commodityId,jdbcType=VARCHAR}, #{commodityCode,jdbcType=VARCHAR}, #{commodityName,jdbcType=VARCHAR},
        #{commodityDescription,jdbcType=VARCHAR}, #{commodityType,jdbcType=CHAR}, #{commodityStatus,jdbcType=CHAR},
        #{commodityPrice,jdbcType=DECIMAL}, #{commodityImg,jdbcType=VARCHAR}, #{screenId,jdbcType=VARCHAR},
        #{startDate,jdbcType=VARCHAR}, #{endDate,jdbcType=VARCHAR}, #{timeFrame,jdbcType=CHAR},
        #{startTime,jdbcType=VARCHAR}, #{endTime,jdbcType=VARCHAR}, #{shelfTime,jdbcType=VARCHAR},
        #{planNumber,jdbcType=INTEGER}, #{singleTime,jdbcType=INTEGER}, #{playTimes,jdbcType=INTEGER},
        #{createdTime,jdbcType=TIMESTAMP}, #{createdBy,jdbcType=VARCHAR}, #{modifiedTime,jdbcType=TIMESTAMP},
        #{modifiedBy,jdbcType=VARCHAR}, #{version,jdbcType=INTEGER}, #{delflag,jdbcType=CHAR}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.liketry.interaction.benison.model.Commodity">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        insert into bu_commodity
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="commodityId != null">
                commodity_id,
            </if>
            <if test="commodityCode != null">
                commodity_code,
            </if>
            <if test="commodityName != null">
                commodity_name,
            </if>
            <if test="commodityDescription != null">
                commodity_description,
            </if>
            <if test="commodityType != null">
                commodity_type,
            </if>
            <if test="commodityStatus != null">
                commodity_status,
            </if>
            <if test="commodityPrice != null">
                commodity_price,
            </if>
            <if test="commodityImg != null">
                commodity_img,
            </if>
            <if test="screenId != null">
                screen_id,
            </if>
            <if test="startDate != null">
                start_date,
            </if>
            <if test="endDate != null">
                end_date,
            </if>
            <if test="timeFrame != null">
                time_frame,
            </if>
            <if test="startTime != null">
                start_time,
            </if>
            <if test="endTime != null">
                end_time,
            </if>
            <if test="shelfTime != null">
                shelf_time,
            </if>
            <if test="planNumber != null">
                plan_number,
            </if>
            <if test="singleTime != null">
                single_time,
            </if>
            <if test="playTimes != null">
                play_times,
            </if>
            <if test="createdTime != null">
                created_time,
            </if>
            <if test="createdBy != null">
                created_by,
            </if>
            <if test="modifiedTime != null">
                modified_time,
            </if>
            <if test="modifiedBy != null">
                modified_by,
            </if>
            <if test="version != null">
                version,
            </if>
            <if test="delflag != null">
                delflag,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="commodityId != null">
                #{commodityId,jdbcType=VARCHAR},
            </if>
            <if test="commodityCode != null">
                #{commodityCode,jdbcType=VARCHAR},
            </if>
            <if test="commodityName != null">
                #{commodityName,jdbcType=VARCHAR},
            </if>
            <if test="commodityDescription != null">
                #{commodityDescription,jdbcType=VARCHAR},
            </if>
            <if test="commodityType != null">
                #{commodityType,jdbcType=CHAR},
            </if>
            <if test="commodityStatus != null">
                #{commodityStatus,jdbcType=CHAR},
            </if>
            <if test="commodityPrice != null">
                #{commodityPrice,jdbcType=DECIMAL},
            </if>
            <if test="commodityImg != null">
                #{commodityImg,jdbcType=VARCHAR},
            </if>
            <if test="screenId != null">
                #{screenId,jdbcType=VARCHAR},
            </if>
            <if test="startDate != null">
                #{startDate,jdbcType=VARCHAR},
            </if>
            <if test="endDate != null">
                #{endDate,jdbcType=VARCHAR},
            </if>
            <if test="timeFrame != null">
                #{timeFrame,jdbcType=CHAR},
            </if>
            <if test="startTime != null">
                #{startTime,jdbcType=VARCHAR},
            </if>
            <if test="endTime != null">
                #{endTime,jdbcType=VARCHAR},
            </if>
            <if test="shelfTime != null">
                #{shelfTime,jdbcType=VARCHAR},
            </if>
            <if test="planNumber != null">
                #{planNumber,jdbcType=INTEGER},
            </if>
            <if test="singleTime != null">
                #{singleTime,jdbcType=INTEGER},
            </if>
            <if test="playTimes != null">
                #{playTimes,jdbcType=INTEGER},
            </if>
            <if test="createdTime != null">
                #{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createdBy != null">
                #{createdBy,jdbcType=VARCHAR},
            </if>
            <if test="modifiedTime != null">
                #{modifiedTime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifiedBy != null">
                #{modifiedBy,jdbcType=VARCHAR},
            </if>
            <if test="version != null">
                #{version,jdbcType=INTEGER},
            </if>
            <if test="delflag != null">
                #{delflag,jdbcType=CHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.liketry.interaction.benison.model.Commodity">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        update bu_commodity
        <set>
            <if test="commodityCode != null">
                commodity_code = #{commodityCode,jdbcType=VARCHAR},
            </if>
            <if test="commodityName != null">
                commodity_name = #{commodityName,jdbcType=VARCHAR},
            </if>
            <if test="commodityDescription != null">
                commodity_description = #{commodityDescription,jdbcType=VARCHAR},
            </if>
            <if test="commodityType != null">
                commodity_type = #{commodityType,jdbcType=CHAR},
            </if>
            <if test="commodityStatus != null">
                commodity_status = #{commodityStatus,jdbcType=CHAR},
            </if>
            <if test="commodityPrice != null">
                commodity_price = #{commodityPrice,jdbcType=DECIMAL},
            </if>
            <if test="commodityImg != null">
                commodity_img = #{commodityImg,jdbcType=VARCHAR},
            </if>
            <if test="screenId != null">
                screen_id = #{screenId,jdbcType=VARCHAR},
            </if>
            <if test="startDate != null">
                start_date = #{startDate,jdbcType=VARCHAR},
            </if>
            <if test="endDate != null">
                end_date = #{endDate,jdbcType=VARCHAR},
            </if>
            <if test="timeFrame != null">
                time_frame = #{timeFrame,jdbcType=CHAR},
            </if>
            <if test="startTime != null">
                start_time = #{startTime,jdbcType=VARCHAR},
            </if>
            <if test="endTime != null">
                end_time = #{endTime,jdbcType=VARCHAR},
            </if>
            <if test="shelfTime != null">
                shelf_time = #{shelfTime,jdbcType=VARCHAR},
            </if>
            <if test="planNumber != null">
                plan_number = #{planNumber,jdbcType=INTEGER},
            </if>
            <if test="singleTime != null">
                single_time = #{singleTime,jdbcType=INTEGER},
            </if>
            <if test="playTimes != null">
                play_times = #{playTimes,jdbcType=INTEGER},
            </if>
            <if test="createdTime != null">
                created_time = #{createdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="createdBy != null">
                created_by = #{createdBy,jdbcType=VARCHAR},
            </if>
            <if test="modifiedTime != null">
                modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
            </if>
            <if test="modifiedBy != null">
                modified_by = #{modifiedBy,jdbcType=VARCHAR},
            </if>
            <if test="version != null">
                version = #{version,jdbcType=INTEGER},
            </if>
            <if test="delflag != null">
                delflag = #{delflag,jdbcType=CHAR},
            </if>
        </set>
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.liketry.interaction.benison.model.Commodity">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 04 10:30:30 CST 2017.
        -->
        update bu_commodity
        set commodity_code = #{commodityCode,jdbcType=VARCHAR},
        commodity_name = #{commodityName,jdbcType=VARCHAR},
        commodity_description = #{commodityDescription,jdbcType=VARCHAR},
        commodity_type = #{commodityType,jdbcType=CHAR},
        commodity_status = #{commodityStatus,jdbcType=CHAR},
        commodity_price = #{commodityPrice,jdbcType=DECIMAL},
        commodity_img = #{commodityImg,jdbcType=VARCHAR},
        screen_id = #{screenId,jdbcType=VARCHAR},
        start_date = #{startDate,jdbcType=VARCHAR},
        end_date = #{endDate,jdbcType=VARCHAR},
        time_frame = #{timeFrame,jdbcType=CHAR},
        start_time = #{startTime,jdbcType=VARCHAR},
        end_time = #{endTime,jdbcType=VARCHAR},
        shelf_time = #{shelfTime,jdbcType=VARCHAR},
        plan_number = #{planNumber,jdbcType=INTEGER},
        single_time = #{singleTime,jdbcType=INTEGER},
        play_times = #{playTimes,jdbcType=INTEGER},
        created_time = #{createdTime,jdbcType=TIMESTAMP},
        created_by = #{createdBy,jdbcType=VARCHAR},
        modified_time = #{modifiedTime,jdbcType=TIMESTAMP},
        modified_by = #{modifiedBy,jdbcType=VARCHAR},
        version = #{version,jdbcType=INTEGER},
        delflag = #{delflag,jdbcType=CHAR}
        where commodity_id = #{commodityId,jdbcType=VARCHAR}
    </update>

    <resultMap id="BaseResultMapAndStock" type="com.liketry.interaction.benison.vo.api.CommodityVo">
        <id column="commodity_id" jdbcType="VARCHAR" property="commodityId"/>
        <result column="commodity_code" jdbcType="VARCHAR" property="commodityCode"/>
        <result column="commodity_name" jdbcType="VARCHAR" property="commodityName"/>
        <result column="commodity_description" jdbcType="VARCHAR" property="commodityDescription"/>
        <result column="commodity_type" jdbcType="CHAR" property="commodityType"/>
        <result column="commodity_status" jdbcType="CHAR" property="commodityStatus"/>
        <result column="commodity_price" jdbcType="DECIMAL" property="commodityPrice"/>
        <result column="commodity_img" jdbcType="VARCHAR" property="commodityImg"/>
        <result column="screen_id" jdbcType="VARCHAR" property="screenId"/>
        <result column="start_date" jdbcType="VARCHAR" property="startDate"/>
        <result column="end_date" jdbcType="VARCHAR" property="endDate"/>
        <result column="time_frame" jdbcType="CHAR" property="timeFrame"/>
        <result column="start_time" jdbcType="VARCHAR" property="startTime"/>
        <result column="end_time" jdbcType="VARCHAR" property="endTime"/>
        <result column="shelf_time" jdbcType="VARCHAR" property="shelfTime"/>
        <result column="plan_number" jdbcType="INTEGER" property="planNumber"/>
        <result column="single_time" jdbcType="INTEGER" property="singleTime"/>
        <result column="play_times" jdbcType="INTEGER" property="playTimes"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="created_by" jdbcType="VARCHAR" property="createdBy"/>
        <result column="stock_status" jdbcType="VARCHAR" property="stockStatus"/>
        <result column="schedule_status" jdbcType="VARCHAR" property="scheduleStatus"/>
        <result column="sales" jdbcType="VARCHAR" property="sales"/>
        <result column="stock" jdbcType="VARCHAR" property="stock"/>
        <result column="stock_date" jdbcType="VARCHAR" property="validDate"/>
    </resultMap>

    <select id="selectByScreenId" resultMap="BaseResultMapAndStock">
    select * from
    (
    (select
    bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
    sales,stock,stock_date,stock_status,schedule_status,
    if(stock > 0,'1','0') as display
    from bu_commodity,bu_stock
    where bu_commodity.commodity_id = bu_stock.commodity_id
    and commodity_status = '1' and stock_status = '1' and schedule_status = '0' and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
    and screen_id = #{screenId,jdbcType=VARCHAR}
    and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') &gt;= #{reserveDate,jdbcType=DATE}
    and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}
    and (str_to_date(stock_date,'%Y-%m-%d') &gt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &gt; DATE_FORMAT(curtime(),'%H:%i')))
    )
    UNION ALL
    (select
    bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
    sales,stock,stock_date,stock_status,schedule_status,
    '0' as display
    from bu_commodity,bu_stock
    where bu_commodity.commodity_id = bu_stock.commodity_id
    and commodity_status = '1' and stock_status = '1' and schedule_status = '0' and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
    and screen_id = #{screenId,jdbcType=VARCHAR}
    and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') &gt;= #{reserveDate,jdbcType=DATE}
    and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}
    and (str_to_date(stock_date,'%Y-%m-%d') &lt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &lt;= DATE_FORMAT(curtime(),'%H:%i')))
    )
    )
    temp order by display desc, shelf_time asc
  </select>

    <select id="selectByNearCommodity" resultMap="BaseResultMapAndStock">
        select
        bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
        sales,stock,stock_date,stock_status,schedule_status
        from bu_commodity,bu_stock
        where bu_commodity.commodity_id = bu_stock.commodity_id
        and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
        and screen_id = #{screenId,jdbcType=VARCHAR}
        and start_date &lt;= #{reserveDate,jdbcType=VARCHAR} and end_date &gt;= #{reserveDate,jdbcType=VARCHAR} and stock_date = #{reserveDate,jdbcType=VARCHAR}
        ORDER BY shelf_time ASC;
    </select>
    <resultMap id="promotionVo" extends="BaseResultMapAndStock" type="com.liketry.interaction.benison.vo.api.PromotionCommodityVo">
        <result column="detail_id" jdbcType="VARCHAR" property="detailId"/>
        <result column="promotion_id" jdbcType="VARCHAR" property="promotionId"/>
        <result column="discount_ratio" jdbcType="VARCHAR" property="discountRatio"/>

        <result column="screen_name" jdbcType="VARCHAR" property="screenName"/>
        <result column="screen_location" jdbcType="VARCHAR" property="screenLocation"/>
        <result column="commodity_num" jdbcType="VARCHAR" property="commodityNum"/>
    </resultMap>

    <select id="selectPromotionNearCommodity" resultMap="promotionVo">
     select
bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, bu_screen.screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
sales,stock,stock_date,stock_status,schedule_status,
discount_ratio,detail_id,bu_promotion_detail.promotion_id,
bu_screen.screen_name,bu_screen.screen_location,commodity_num
from bu_promotion_detail,bu_commodity,bu_stock,bu_promotion,bu_screen
where bu_promotion_detail.commodity_id = bu_commodity.commodity_id
and bu_screen.screen_id = bu_commodity.screen_id
and bu_commodity.commodity_id = bu_stock.commodity_id
      and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
      and bu_promotion_detail.promotion_id = #{promotionId} and bu_commodity.commodity_id=#{commodityId}
      and (str_to_date(stock_date,'%Y-%m-%d') > curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')))
      ORDER BY stock_date ASC;
    </select>

    <!--获取定制商品-->
    <select id="selectCustomCommodity" resultMap="BaseResultMapAndStock">
        SELECT * FROM
        (
        (select
    bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status,custom_price as commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
    sales,stock,stock_date,stock_status,schedule_status,
    if(stock > 0,'1','0') as display
    from bu_commodity,bu_stock,bu_conf_custom
    where bu_commodity.commodity_id = bu_stock.commodity_id
    and bu_conf_custom.delflag = '1'
    and commodity_status = '1' and stock_status = '1' and schedule_status = '0' and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
    and screen_id = #{screenId,jdbcType=VARCHAR}
    and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') &gt;= #{reserveDate,jdbcType=DATE}
    and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}
    and (str_to_date(stock_date,'%Y-%m-%d') &gt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &gt; DATE_FORMAT(curtime(),'%H:%i')))
    and bu_conf_custom.custom_type = #{type, jdbcType=DATE}
    )
    UNION ALL
    (select
    bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status,custom_price as commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
    sales,stock,stock_date,stock_status,schedule_status,
    '0' as display
    from bu_commodity,bu_stock,bu_conf_custom
    where bu_commodity.commodity_id = bu_stock.commodity_id
    and bu_conf_custom.delflag = '1'
    and commodity_status = '1' and stock_status = '1' and schedule_status = '0' and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
    and screen_id = #{screenId,jdbcType=VARCHAR}
    and str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=DATE} and str_to_date(end_date,'%Y-%m-%d') &gt;= #{reserveDate,jdbcType=DATE}
    and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=DATE}
    and (str_to_date(stock_date,'%Y-%m-%d') &lt; curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time &lt;= DATE_FORMAT(curtime(),'%H:%i')))
    and bu_conf_custom.custom_type = #{type, jdbcType=DATE}
    )
    )
    temp order by display desc, shelf_time asc
    </select>

    <select id="selectPromotionSingleCommodity" resultMap="promotionVo">
        select
        bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, commodity_price, bu_screen.screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
        sales,stock,stock_date,stock_status,schedule_status,
        discount_ratio,detail_id,bu_promotion_detail.promotion_id,
        bu_screen.screen_name,bu_screen.screen_location,
        if((str_to_date(stock_date,'%Y-%m-%d') > curdate()  or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')) and stock > 0)  ,'1','0') as display
        from bu_promotion_detail,bu_commodity,bu_stock,bu_promotion,bu_screen
        where bu_promotion_detail.commodity_id = bu_commodity.commodity_id
        and bu_screen.screen_id = bu_commodity.screen_id
        and bu_commodity.commodity_id = bu_stock.commodity_id
        and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
        and bu_promotion_detail.promotion_id = #{promotionId} and bu_commodity.commodity_id=#{commodityId} and stock_date = #{reserveDate,jdbcType=DATE}
    </select>


    <select id="selectByNearCustomCommodity" resultMap="promotionVo">
        select
        bu_commodity.commodity_id, commodity_code, commodity_name, commodity_description, commodity_type, commodity_status, custom_price as commodity_price, screen_id, start_date, end_date, time_frame, bu_commodity.start_time, bu_commodity.end_time, shelf_time, plan_number, bu_commodity.single_time, bu_commodity.play_times,
        sales,stock,stock_date,stock_status,schedule_status
        from bu_commodity,bu_stock,bu_conf_custom
        where bu_commodity.commodity_id = bu_stock.commodity_id
        and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
        and screen_id = #{screenId,jdbcType=VARCHAR}
        and start_date &lt;= #{reserveDate,jdbcType=VARCHAR} and end_date &gt;= #{reserveDate,jdbcType=VARCHAR} and stock_date = #{reserveDate,jdbcType=VARCHAR}
        and bu_conf_custom.custom_type = #{type, jdbcType=VARCHAR}
        ORDER BY shelf_time ASC;
    </select>
    <select id="selectLatestCommodityStock" resultType="Integer">
        select count(*) from bu_commodity,bu_stock where
        str_to_date(start_date,'%Y-%m-%d') &lt;= #{reserveDate,jdbcType=VARCHAR} and str_to_date(end_date,'%Y-%m-%d') >= #{reserveDate,jdbcType=VARCHAR}
        and str_to_date(stock_date,'%Y-%m-%d') = #{reserveDate,jdbcType=VARCHAR}
        and screen_id = #{screenId,jdbcType=VARCHAR}
        and commodity_status = '1' and stock_status = '1' and schedule_status = '0'
        and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
        and (str_to_date(stock_date,'%Y-%m-%d') > curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')))
        and stock > 0
    </select>
    <select id="selectPromotionLatestCommodityStock" resultType="Integer">
        select count(*) from bu_commodity,bu_stock,bu_promotion where
        bu_promotion.promotion_id = #{promotionId,jdbcType=VARCHAR} and bu_commodity.commodity_id = #{commodityId,jdbcType=VARCHAR}
        and str_to_date(bu_promotion.start_time,'%Y-%m-%d %H:%i:%s') &lt;= str_to_date(#{reserveDate,jdbcType=VARCHAR},'%Y-%m-%d %H:%i:%s') and str_to_date(bu_promotion.end_time,'%Y-%m-%d %H:%i:%s') >= str_to_date(#{reserveDate,jdbcType=VARCHAR},'%Y-%m-%d %H:%i:%s')
        and str_to_date(start_date,'%Y-%m-%d') &lt;= str_to_date(#{reserveDate,jdbcType=VARCHAR},'%Y-%m-%d')  and str_to_date(end_date,'%Y-%m-%d') >= str_to_date(#{reserveDate,jdbcType=VARCHAR},'%Y-%m-%d')
        and str_to_date(stock_date,'%Y-%m-%d') = str_to_date(#{reserveDate,jdbcType=VARCHAR},'%Y-%m-%d')
        and commodity_status = '1' and stock_status = '1' and schedule_status = '0'
        and bu_commodity.start_time = bu_stock.start_time and bu_commodity.end_time = bu_stock.end_time
        and (str_to_date(stock_date,'%Y-%m-%d') > curdate() or (str_to_date(stock_date,'%Y-%m-%d') = curdate() and shelf_time > DATE_FORMAT(curtime(),'%H:%i')))
        and stock > 0
    </select>

    <select id="getLimitSize" resultType="Integer">
        SELECT count(*) FROM bu_order left join bu_order_detail
        on bu_order.order_id = bu_order_detail.order_id
        where bu_order.promotion_id = #{promotionId,jdbcType=VARCHAR}
        and bu_order.order_status in (1, 2, 3)
        and str_to_date(bu_order_detail.play_date,'%Y-%m-%d') = #{reserveDate}
        and commodity_id = #{commodityId,jdbcType=VARCHAR}
    </select>
</mapper>